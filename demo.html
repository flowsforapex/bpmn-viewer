<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Flows for APEX - Viewer</title>

  <style type="text/css">
    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
    }

    #container {
      height: 100%;
      padding: 0;
      margin: 0;
      display: flex;
      width: 100vw;
      flex-direction: row;
    }

    #canvas_left, #canvas_right {
      height: 100%;
      padding: 0;
      margin: 0;
      width: 50vw;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="canvas_left"></div>
    <div id="canvas_right"></div>
  </div>
  <script src="./bundle.js"></script>
  <script>

    var myBpmnViewer_left = new bpmnViewer.NavigatedViewer({
      container: "#canvas_left",
      additionalModules: [
        bpmnViewer.customModules.spViewModule,
        bpmnViewer.customModules.styleModule
      ],
    });

    var myBpmnViewer_right = new bpmnViewer.NavigatedViewer({
      container: "#canvas_right",
      additionalModules: [
        bpmnViewer.customModules.spViewModule,
        bpmnViewer.customModules.styleModule
      ],
    });

    async function openDiagram(viewer, bpmnXML) {
      // import diagram
      try {
        await viewer.importXML(bpmnXML);

        // access viewer components
        var canvas = viewer.get("canvas");
        var overlays = viewer.get("overlays");

        // zoom to fit full viewport
        canvas.zoom("fit-viewport");
      } catch (err) {
        console.error("could not import BPMN 2.0 diagram", err);
      }
    }

    Promise.all([
      fetch('test1.bpmn'),
      fetch('test2.bpmn')
    ]).then((responses) => {
      return Promise.all(responses.map(function (response) {
        return response.text();
      }));
    }).then((text) => {
        var flow_left = text[0];
        openDiagram(myBpmnViewer_left, flow_left);
        var flow_right = text[1];
        openDiagram(myBpmnViewer_right, flow_right);

        bpmnViewer.diffModels(flow_left, flow_right);
    });

  </script>
</body>
</html>